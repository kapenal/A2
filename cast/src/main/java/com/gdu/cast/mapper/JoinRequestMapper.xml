<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.gdu.cast.mapper.JoinRequestMapper">
	<!-- JoinTraveler와 Traveler vo를 합침 -->
	<resultMap type="com.gdu.cast.vo.JoinTraveler" id="resultJoinTraveler">
		<id column="join_traveler_id" property="joinTravelerId"></id>
		<result column="traveler_id" property="travelerId"></result>
		<result column="admin_id" property="adminId"></result>
		<result column="active" property="active"></result>
		<result column="create_date" property="createDate"></result>
		<result column="update_date" property="updateDate"></result>
		<collection property="traveler" ofType="com.gdu.cast.vo.Traveler">
			<id column="traveler_id" property="travelerId"></id>
			<result column="traveler_name" property="travelerName"></result>
			<result column="traveler_phonenum" property="travelerPhoneNum"></result>
			<result column="traveler_email" property="travelerEmail"></result>
			<result column="traveler_license" property="travelerLicense"></result>
			<result column="traveler_career" property="travelerCareer"></result>
		</collection>
	</resultMap>
	
	<!-- JoinCeo와 Ceo vo를 합침 -->
	<resultMap type="com.gdu.cast.vo.JoinCeo" id="resultJoinCeo">
		<id column="join_ceo_id" property="joinCeoId"></id>
		<result column="ceo_id" property="ceoId"></result>
		<result column="admin_id" property="adminId"></result>
		<result column="active" property="active"></result>
		<result column="create_date" property="createDate"></result>
		<result column="update_date" property="updateDate"></result>
		<collection property="ceo" ofType="com.gdu.cast.vo.Ceo">
			<id column="ceo_id" property="ceoId"></id>
			<result column="ceo_name" property="ceoName"></result>
			<result column="ceo_phonenum" property="ceoPhonenum"></result>
			<result column="ceo_email" property="ceoEmail"></result>
			<result column="ceo_license" property="ceoLicense"></result>
		</collection>
	</resultMap>
	
	<!-- 여행작가 회원가입 요청 추가 -->
	<insert id="insertTravelerJoinRequest" parameterType="com.gdu.cast.vo.JoinTraveler">
		INSERT INTO join_traveler(
			traveler_id, active, create_date, update_date) 
			VALUES( #{travelerId}, '요청', now(), now())
	</insert>
	
	<!-- 여행작가 회원가입 요청 중인 리스트 4개 -->
	<select id="selectTravelerJoinRequestList4" resultType="com.gdu.cast.vo.JoinTraveler">
		SELECT join_traveler_id joinTravelerId, traveler_id travelerId, create_date createDate
		FROM join_traveler
		WHERE active = '요청'
		ORDER BY create_date DESC
		LIMIT 0, 4
	</select>
	
	<!-- 여행작가 가입 요청 리스트 -->
	<select id="selectTravelerJoinRequestList" parameterType="Map" resultMap="resultJoinTraveler">
		SELECT	jt.join_traveler_id, jt.active, t.traveler_id, t.traveler_name,
				t.traveler_phonenum, t.traveler_email,
				t.traveler_license, t.traveler_career, jt.create_date
		FROM join_traveler jt
		JOIN traveler t ON jt.traveler_id = t.traveler_id
		<where>
			<choose>
				<when test='(state != null or state == "") and (searchTitle != null or searchTitle == "")'>
					jt.active LIKE '%${state}%' AND t.traveler_id LIKE '%${searchTitle}%'
				</when>
				<when test='state != null or state == ""'>
					jt.active LIKE '%${state}%'
				</when>
				<when test='searchTitle != null or searchTitle == ""'>
					t.traveler_id LIKE '%${searchTitle}%'
				</when>
			</choose>
		</where>
		ORDER BY jt.create_date DESC
		LIMIT #{beginRow}, #{ROW_PER_PAGE}
	</select>
	
	<!-- 여행작가 가입 요청 리스트 글갯수 -->
	<select id="selectTravelerJoinRequestTotalCount" parameterType="String" resultType="int">
		SELECT	COUNT(*)
		FROM join_traveler jt
		JOIN traveler t ON jt.traveler_id = t.traveler_id
		<where>
			<choose>
				<when test='(state != null or state == "") and (searchTitle != null or searchTitle == "")'>
					jt.active LIKE '%${state}%' AND t.traveler_id LIKE '%${searchTitle}%'
				</when>
				<when test='state != null or state == ""'>
					jt.active LIKE '%${state}%'
				</when>
				<when test='searchTitle != null or searchTitle == ""'>
					t.traveler_id LIKE '%${searchTitle}%'
				</when>
			</choose>
		</where>
	</select>
	
	<!-- 여행작가 상세보기 -->
	<select id="selectTravelerOne" parameterType="int" resultMap="resultJoinTraveler">
		SELECT
			jt.join_traveler_id, jt.active,
			t.traveler_id, t.traveler_name, t.traveler_jumin, t.traveler_phonenum,
			t.traveler_email, t.traveler_license, t.traveler_career
		FROM join_traveler jt JOIN traveler t ON jt.traveler_id = t.traveler_id
		WHERE jt.join_traveler_id = #{joinTravelerId}
	</select>
	
	<!-- 여행작가 가입 요청 처리 시 -->
	<update id="updateTravelerJoinRequest" parameterType="Map">
		UPDATE join_traveler SET
			active = #{state}, admin_id = #{adminId}, update_date = NOW()
		WHERE join_traveler_id = #{joinTravelerId}
	</update>
	
	<!-- 여행작가 로그인 시 가입 요청 결과 -->
	<select id="selectTravelerJoinRequestResult" parameterType="String" resultType="String">
		SELECT active active
		FROM join_traveler
		WHERE traveler_id = #{travelerId}
		ORDER BY create_date DESC
		LIMIT 0, 1
	</select>
	
	<!-- 여행작가 가입 거절시 요청 결과 삭제 -->
	<delete id="deleteTravelerJoinRequest" parameterType="String">
		DELETE FROM join_traveler
		WHERE traveler_id = #{travelerId}
	</delete>
	
	<!-- 여행작가 가입 거절시 여행작가 회원가입 삭제 -->
	<delete id="deleteTravelerMembership" parameterType="String">
		DELETE FROM traveler
		WHERE traveler_id = #{travelerId}
	</delete>
	
	<!-- /////////////////// 사업자 \\\\\\\\\\\\\\\\\\\\-->
	
	<!-- 사업자 회원가입 요청 추가 -->
	<insert id="insertCeoJoinRequest" parameterType="com.gdu.cast.vo.JoinCeo">
		INSERT INTO join_ceo(
			ceo_id, active, create_date, update_date) 
			VALUES( #{ceoId}, '요청', now(), now())
	</insert>
	
	<!-- 사업자 회원가입 요청 중인 리스트 4개 -->
	<select id="selectCeoJoinRequestList4" resultType="com.gdu.cast.vo.JoinCeo">
		SELECT join_ceo_id joinCeoId, ceo_id ceoId, create_date createDate
		FROM join_ceo
		WHERE active = '요청'
		ORDER BY create_date DESC
		LIMIT 0, 4
	</select>
	
	<!-- 사업자 가입 요청 리스트 -->
	<select id="selectCeoJoinRequestList" parameterType="Map" resultMap="resultJoinCeo">
		SELECT	jc.join_ceo_id, jc.active, c.ceo_id, c.ceo_name,
				c.ceo_phonenum, c.ceo_email,
				c.ceo_license, jc.create_date
		FROM join_ceo jc
		JOIN ceo c ON jc.ceo_id = c.ceo_id
		<where>
			<choose>
				<when test='(state != null or state == "") and (searchTitle != null or searchTitle == "")'>
					jc.active LIKE '%${state}%' AND c.ceo_id LIKE '%${searchTitle}%'
				</when>
				<when test='state != null or state == ""'>
					jc.active LIKE '%${state}%'
				</when>
				<when test='searchTitle != null or searchTitle == ""'>
					c.ceo_id LIKE '%${searchTitle}%'
				</when>
			</choose>
		</where>
		ORDER BY jc.create_date DESC
		LIMIT #{beginRow}, #{ROW_PER_PAGE}
	</select>
	
	<!-- 사업자 가입 요청 리스트 글갯수 -->
	<select id="selectCeoJoinRequestTotalCount" parameterType="String" resultType="int">
		SELECT	COUNT(*)
		FROM join_ceo jc
		JOIN ceo c ON jc.ceo_id = c.ceo_id
		<where>
			<choose>
				<when test='(state != null or state == "") and (searchTitle != null or searchTitle == "")'>
					jc.active LIKE '%${state}%' AND c.ceo_id LIKE '%${searchTitle}%'
				</when>
				<when test='state != null or state == ""'>
					jc.active LIKE '%${state}%'
				</when>
				<when test='searchTitle != null or searchTitle == ""'>
					c.ceo_id LIKE '%${searchTitle}%'
				</when>
			</choose>
		</where>
	</select>
	
	<!-- 사업자 상세보기 -->
	<select id="selectCeoOne" parameterType="int" resultMap="resultJoinCeo">
		SELECT
			jc.join_ceo_id, jc.active,
			c.ceo_id, c.ceo_name, c.ceo_jumin, c.ceo_phonenum,
			c.ceo_email, c.ceo_license
		FROM join_ceo jc JOIN ceo c ON jc.ceo_id = c.ceo_id
		WHERE jc.join_ceo_id = #{joinCeoId}
	</select>
	
	<!-- 사업자 가입 요청 처리 시 -->
	<update id="updateCeoJoinRequest" parameterType="Map">
		UPDATE join_ceo SET
			active = #{state}, admin_id = #{adminId}, update_date = NOW()
		WHERE join_ceo_id = #{joinCeoId}
	</update>
	
	<!-- 사업자 로그인 시 가입 요청 결과 -->
	<select id="selectCeoJoinRequestResult" parameterType="String" resultType="String">
		SELECT active active
		FROM join_ceo
		WHERE ceo_id = #{ceoId}
		ORDER BY create_date DESC
		LIMIT 0, 1
	</select>
	
	<!-- 사업자 가입 거절시 요청 결과 삭제 -->
	<delete id="deleteCeoJoinRequest" parameterType="String">
		DELETE FROM join_ceo
		WHERE ceo_id = #{ceoId}
	</delete>
	
	<!-- 사업자 가입 거절시 사업자 회원가입 삭제 -->
	<delete id="deleteCeoMembership" parameterType="String">
		DELETE FROM ceo
		WHERE ceo_id = #{ceoId}
	</delete>
	
</mapper>